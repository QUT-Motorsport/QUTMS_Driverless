ARG L4T_MINOR_VERSION=6.1

FROM qutms_driverless_base:l4t-r32.${L4T_MINOR_VERSION}
# qutms_driverless_base generated by qutms_driverless/docker/Makefile

ARG USERNAME
ARG HOST_UID
# dialout group is used for compatability with mac
ARG HOST_GROUP=dialout

WORKDIR /tmp

# sensors
COPY ./src/hardware/sensors/conda_requirements ./conda_requirements
RUN source /home/${USERNAME}/mambaforge/bin/activate; \
    conda activate driverless_env &&\
    mamba install --file ./conda_requirements

# vision pipeline - uses special case jetson_install.sh instead of conda_requirements
COPY ./src/perception/vision_pipeline/jetson_install.sh ./jetson_install.sh
RUN ./jetson_install.sh

# cleanup
RUN rm -f conda_requirements
WORKDIR /home/$USERNAME/driverless_ws
